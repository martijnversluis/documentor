<div class="bg-white rounded-lg shadow-sm border border-gray-200" data-controller="review-step" data-review-step-auto-save-url-value="<%= review_review_step_path(review, step) %>">
  <div class="p-4 border-b border-gray-100 bg-gray-50 rounded-t-lg">
    <div class="flex items-center justify-between">
      <span class="text-sm text-gray-500">Stap <%= step.position + 1 %> van <%= review.review_steps.count %></span>
    </div>
    <h2 class="text-xl font-semibold text-gray-900 mt-1 prose prose-sm max-w-none"><%= markdown(step.title) %></h2>
  </div>

  <% if step.description.present? %>
    <div class="p-6 prose prose-sm max-w-none border-b border-gray-100">
      <%= markdown(step.description) %>
    </div>
  <% end %>

  <div class="p-6">
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700 mb-2">Notities (optioneel)</label>
      <%= text_area_tag :notes, step.notes, rows: 4,
          id: "step_notes_#{step.id}",
          class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",
          placeholder: "Voeg notities of resultaten toe...",
          data: { review_step_target: "notes", action: "input->review-step#scheduleAutoSave" } %>
    </div>

    <div class="flex items-center justify-between">
      <div class="flex items-center gap-2">
        <% if step.position > 0 %>
          <% prev_step = review.review_steps.find_by(position: step.position - 1) %>
          <% if prev_step %>
            <%= link_to review_review_step_path(review, prev_step),
                class: "px-4 py-2 text-gray-600 hover:text-gray-900 flex items-center gap-1",
                data: { turbo_stream: true } do %>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
              Vorige
            <% end %>
          <% end %>
        <% end %>
        <% next_step = review.review_steps.find_by(position: step.position + 1) %>
        <% if next_step && (step.completed? || step.skipped?) %>
          <%= link_to review_review_step_path(review, next_step),
              class: "px-4 py-2 text-gray-600 hover:text-gray-900 flex items-center gap-1",
              data: { turbo_stream: true } do %>
            Volgende
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          <% end %>
        <% end %>
      </div>

      <div class="flex items-center gap-2">
        <%= form_with url: skip_review_review_step_path(review, step), method: :patch, data: { turbo: false }, class: "inline" do |f| %>
          <%= hidden_field_tag :notes, "", id: "skip_notes_#{step.id}" %>
          <button type="submit" class="px-4 py-2 text-gray-500 hover:text-gray-700 cursor-pointer">
            Overslaan
          </button>
        <% end %>
        <%= form_with url: complete_review_review_step_path(review, step), method: :patch, data: { turbo: false, action: "submit->review-step#syncNotes" }, class: "inline" do |f| %>
          <%= hidden_field_tag :notes, step.notes, id: "complete_notes_#{step.id}", data: { review_step_target: "hiddenNotes" } %>
          <button type="submit" class="px-6 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 cursor-pointer flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            Voltooien
          </button>
        <% end %>
      </div>
    </div>
  </div>
</div>
