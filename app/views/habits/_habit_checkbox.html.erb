<% if habit.counter_mode? %>
  <% current_count = habit.completion_count_for(date) %>
  <% completed = current_count >= habit.target_count %>
  <div class="flex items-center gap-1">
    <div class="w-5 h-5 flex items-center justify-center">
      <% if current_count > 0 %>
        <%= button_to decrement_habit_path(habit, date: date), method: :post, class: "w-5 h-5 rounded flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 cursor-pointer", data: { turbo_frame: "_top" } do %>
          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
          </svg>
        <% end %>
      <% end %>
    </div>
    <span class="text-sm font-medium w-8 text-center <%= completed ? 'text-green-600' : 'text-gray-600' %>">
      <%= current_count %>/<%= habit.target_count %>
    </span>
    <%= button_to increment_habit_path(habit, date: date), method: :post, class: "w-5 h-5 rounded flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 cursor-pointer", data: { turbo_frame: "_top" } do %>
      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
      </svg>
    <% end %>
  </div>
<% else %>
  <%= button_to toggle_habit_path(habit, date: date), method: :post, class: "w-6 h-6 rounded border-2 flex items-center justify-center cursor-pointer transition-colors #{habit.completed_on?(date) ? "#{habit.color_classes[:bg]} #{habit.color_classes[:border]} text-white" : "border-gray-300 hover:border-gray-400"}", data: { turbo_frame: "_top" } do %>
    <% if habit.completed_on?(date) %>
      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
      </svg>
    <% end %>
  <% end %>
<% end %>
