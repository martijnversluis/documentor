<%= form_with model: habit, class: "space-y-6" do |f| %>
  <% if habit.errors.any? %>
    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
      <div class="flex items-center gap-2 text-red-800 mb-2">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
        </svg>
        <span class="font-medium">Er zijn fouten gevonden</span>
      </div>
      <ul class="list-disc list-inside text-sm text-red-700">
        <% habit.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <%= f.label :name, "Naam", class: "block text-sm font-medium text-gray-700 mb-1" %>
    <%= f.text_field :name, class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent", placeholder: "bijv. Mediteren, Sporten, Lezen" %>
  </div>

  <div>
    <%= f.label :description, "Beschrijving (optioneel)", class: "block text-sm font-medium text-gray-700 mb-1" %>
    <%= f.text_area :description, rows: 2, class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent", placeholder: "Extra details over deze gewoonte..." %>
  </div>

  <div class="grid grid-cols-2 gap-4">
    <div>
      <%= f.label :frequency, "Frequentie", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= f.select :frequency, [["Dagelijks", "daily"], ["Werkdagen", "weekdays"], ["Specifieke dagen", "weekly"]], {}, class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
    </div>

    <div>
      <%= f.label :color, "Kleur", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= f.select :color, [["Blauw", "blue"], ["Groen", "green"], ["Paars", "purple"], ["Oranje", "orange"], ["Roze", "pink"], ["Rood", "red"], ["Geel", "yellow"]], {}, class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
    </div>
  </div>

  <div data-controller="habit-days" data-habit-days-frequency-value="<%= habit.frequency || 'daily' %>">
    <div data-habit-days-target="daysContainer" class="<%= habit.frequency == 'weekly' ? '' : 'hidden' %>">
      <label class="block text-sm font-medium text-gray-700 mb-2">Op welke dagen?</label>
      <div class="flex gap-2 flex-wrap">
        <% %w[Zo Ma Di Wo Do Vr Za].each_with_index do |day_name, i| %>
          <label class="flex items-center gap-2 px-3 py-2 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
            <%= check_box_tag "habit[target_days][]", i, habit.target_days_array.include?(i), class: "w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" %>
            <span class="text-sm"><%= day_name %></span>
          </label>
        <% end %>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-2 gap-4">
    <div>
      <%= f.label :duration_seconds, "Timer duur (optioneel)", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <div class="flex items-center gap-1">
        <input type="number" id="duration_minutes" min="0" max="59" placeholder="0"
               value="<%= habit.duration_seconds.to_i / 60 if habit.duration_seconds.to_i > 0 %>"
               class="w-16 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center"
               oninput="updateDurationTotal()">
        <span class="text-gray-500">:</span>
        <input type="number" id="duration_seconds_part" min="0" max="59" placeholder="00"
               value="<%= habit.duration_seconds.to_i % 60 if habit.duration_seconds.to_i > 0 %>"
               class="w-16 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center"
               oninput="updateDurationTotal()">
        <span class="text-sm text-gray-500 ml-1">min:sec</span>
      </div>
      <%= f.hidden_field :duration_seconds, id: "duration_total" %>
      <p class="text-xs text-gray-500 mt-1">Voor oefeningen met een vaste duur</p>
      <script>
        function updateDurationTotal() {
          const minutes = parseInt(document.getElementById('duration_minutes').value) || 0;
          const seconds = parseInt(document.getElementById('duration_seconds_part').value) || 0;
          const total = (minutes * 60) + seconds;
          document.getElementById('duration_total').value = total > 0 ? total : '';
        }
        document.addEventListener('DOMContentLoaded', updateDurationTotal);
        document.addEventListener('turbo:load', updateDurationTotal);
      </script>
    </div>

    <div>
      <%= f.label :target_count, "Aantal per dag", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= f.number_field :target_count, min: 1, max: 99, class: "w-20 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center" %>
      <p class="text-xs text-gray-500 mt-1">Hoe vaak per dag? (standaard 1)</p>
    </div>
  </div>

  <div class="flex items-center gap-2">
    <%= f.check_box :active, class: "w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" %>
    <%= f.label :active, "Actief", class: "text-sm font-medium text-gray-700" %>
  </div>

  <div class="flex items-center gap-3 pt-4 border-t">
    <%= f.submit habit.persisted? ? "Opslaan" : "Aanmaken", class: "px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 cursor-pointer" %>
    <%= link_to "Annuleren", habits_path, class: "px-4 py-2 text-gray-700 text-sm font-medium hover:bg-gray-100 rounded-lg" %>

    <% if habit.persisted? %>
      <div class="ml-auto">
        <%= button_to habit_path(habit), method: :delete, class: "px-4 py-2 text-red-600 text-sm font-medium hover:bg-red-50 rounded-lg cursor-pointer", form: { data: { turbo_confirm: "Weet je zeker dat je deze gewoonte wilt verwijderen?" } } do %>
          Verwijderen
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>
